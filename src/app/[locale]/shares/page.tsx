import type { Metadata } from 'next';
import { headers } from 'next/headers';
import { dehydrate, HydrationBoundary, QueryClient } from '@tanstack/react-query';

import { getCommunityShares } from '@/api/shares';

import Information from '@/components/shares/Information';

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
};

export default async function Shares() {
  const headerList = headers();
  const communityId = new URLSearchParams(headerList.get('search') ?? {}).get('community_id');

  const queryClient = new QueryClient();

  if (communityId) {
    await queryClient.prefetchQuery({
      queryKey: [communityId],
      queryFn: async () => getCommunityShares(communityId),
    });
  }

  return (
    <HydrationBoundary state={dehydrate(queryClient)}>
      <Information />
    </HydrationBoundary>
  );
}
